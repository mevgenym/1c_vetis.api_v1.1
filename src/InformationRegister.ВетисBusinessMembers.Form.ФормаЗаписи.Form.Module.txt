
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("BusinessEntity") Тогда
		Запись.BusinessEntity = Параметры.BusinessEntity;
	КонецЕсли;
	
	Если Параметры.Свойство("Enterprise") Тогда
		Запись.Enterprise = Параметры.Enterprise;
	КонецЕсли;
	
	Если Параметры.Свойство("Использовать") Тогда
		Запись.Использовать = Параметры.Использовать;
	КонецЕсли;
	
	Если Параметры.Свойство("Свой") Тогда
		Запись.Свой = Параметры.Свой;
	КонецЕсли;
	
КонецПроцедуры


&НаКлиенте
Процедура КомандаОбновитьСвязь(Команда)
	
	Перем _Отказ, _Ошибка;
	
	_ЕстьСвязь = ПолучитьСвязьНаСервере(Запись.BusinessEntity, Запись.Enterprise, _Отказ, _Ошибка);
	
	Если _Отказ = Истина Тогда
		Сообщить(_Ошибка);
		Возврат;
	КонецЕсли;
	
	Запись.ВСервисе = _ЕстьСвязь = Истина;
	
КонецПроцедуры

&НаСервере
Функция ПолучитьСвязьНаСервере(пХозяйствующийСубъект, пПредприятие, пОтказ = Ложь, пОшибка = "")
	
	_BusinessEntityGuid = ВетисDictionaryСлой1с.BusinessEntity(пХозяйствующийСубъект);
	
	_EnterpriseGuid = ВетисDictionaryСлой1с.Enterprise(пПредприятие);
	
	_Enterprise = Неопределено;
	
	_параметры = Неопределено;
	
	Пока ВетисEnterpriseService.GetActivityLocationListNext(_BusinessEntityGuid, _Enterprise, _параметры, пОтказ, пОшибка) Цикл
		Если пОтказ = Истина Тогда
			Возврат Неопределено;
		ИначеЕсли _EnterpriseGuid = _Enterprise.guid Тогда
			Возврат Истина;
		КонецЕсли;
	КонецЦикла;
	
	Возврат Ложь;
	
КонецФункции

&НаКлиенте
Процедура КомандаПривязатьВСервисе(Команда)
	
	Перем _Отказ, _Ошибка;
	
	ModifyActivityLocations(Запись.BusinessEntity, Запись.Enterprise, Истина, _Отказ, _Ошибка);
	
	Если _Отказ = Истина Тогда
		Сообщить(_Ошибка);
		Возврат;
	КонецЕсли;
	
	КомандаОбновитьСвязь(Команда);
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаОтвязатьВСервисе(Команда)
	
	Перем _Отказ, _Ошибка;
	
	ModifyActivityLocations(Запись.BusinessEntity, Запись.Enterprise, Ложь, _Отказ, _Ошибка);
	
	Если _Отказ = Истина Тогда
		Сообщить(_Ошибка);
		Возврат;
	КонецЕсли;
	
	КомандаОбновитьСвязь(Команда);
	
КонецПроцедуры

&НаСервереБезКонтекста
Процедура ModifyActivityLocations(пХозяйствующийСубъект, пПредприятие, CREATE = Истина, пОтказ = Ложь, пОшибка = "")
	
	ВетисMercuryApplicationsСлой1с.ModifyActivityLocations(пХозяйствующийСубъект, пПредприятие, CREATE, пОтказ, пОшибка);
	
КонецПроцедуры
