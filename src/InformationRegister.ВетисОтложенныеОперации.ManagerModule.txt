
Процедура Добавить(пСсылка, пОперация = Неопределено, пНастройка = Неопределено, пПараметры = Неопределено) Экспорт
	
	_Период = ТекущаяДата();
	_Миллисекунды = ТекущаяУниверсальнаяДатаВМиллисекундах();
	
	_УникальныйИдентификатор = Новый УникальныйИдентификатор;
	
	Если пОперация = Неопределено Тогда
		_Операция = ПредопределенноеЗначение("Перечисление.ВетисОтложенныеОперации.ПоУмолчанию");
	ИначеЕсли ТипЗнч(пОперация) = Тип("Строка") Тогда
		_Операция = ПредопределенноеЗначение("Перечисление.ВетисОтложенныеОперации."+пОперация);
	Иначе
		_Операция = пОперация;
	КонецЕсли;
	
	НаборЗаписей = РегистрыСведений.ВетисОтложенныеОперации.СоздатьНаборЗаписей();
	НаборЗаписей.Отбор.УникальныйИдентификатор.Установить(_УникальныйИдентификатор);
	
	Запись = НаборЗаписей.Добавить();
	Запись.Период = _Период;
	Запись.Миллисекунды = _Миллисекунды % 1000;
	Запись.УникальныйИдентификатор = _УникальныйИдентификатор;
	Запись.Объект = пСсылка;
	Запись.Операция = _Операция;
	Запись.Настройка = пНастройка;
	Запись.Параметры = Новый ХранилищеЗначения(пПараметры);
	
	НаборЗаписей.Записать();
	
КонецПроцедуры

Процедура Удалить(пУникальныйИдентификатор, пСообщение = Неопределено, пОшибка = Ложь, пРезультат = Неопределено) Экспорт
	
	НаборЗаписей = РегистрыСведений.ВетисОтложенныеОперации.СоздатьНаборЗаписей();
	НаборЗаписей.Отбор.УникальныйИдентификатор.Установить(пУникальныйИдентификатор);
	НаборЗаписей.Прочитать();
	Для каждого Запись Из НаборЗаписей Цикл
		Запись.Завершено = Истина;
		Запись.Ошибка = пОшибка;
		Запись.ПредставлениеСообщения = пСообщение;
		Запись.Сообщение = Новый ХранилищеЗначения(пСообщение);
		//Запись.Результат = Новый ХранилищеЗначения(пРезультат);
	КонецЦикла;
	
	Если НаборЗаписей.Модифицированность() Тогда
		НаборЗаписей.Записать();
	КонецЕсли;
	
КонецПроцедуры
