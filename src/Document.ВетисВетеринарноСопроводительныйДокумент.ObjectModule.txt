
Процедура ПриКопировании(ОбъектКопирования)
	
	uuid = Неопределено;
	
	statusChange.Очистить();
	
	СерияВСД = "";
	НомерВСД = "";
	ДатаВСД  = ТекущаяДата();
	Статус   = Неопределено;
	Тип      = Неопределено;
	
	_сж = ?(Товары.Количество() = 0, Товары.Добавить(), Товары[0]);
	
	//_всд = ?(ВСД.Количество() = 0, ВСД.Добавить(), ВСД[0]);
	
	_осм = ?(РезультатыОсмотра.Количество() = 0, РезультатыОсмотра.Добавить(), РезультатыОсмотра[0]);
	
	_ттн = ?(ТТН.Количество() = 0, ТТН.Добавить(), ТТН[0]);
	_ттн.Серия = "";
	_ттн.Номер = "";
	_ттн.Дата = ТекущаяДата();
	
КонецПроцедуры

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, ТекстЗаполнения, СтандартнаяОбработка)
	
	Отправитель = Ветис.ТекущийХС();
	
	ОтправительПредприятие = Ветис.ТекущееПредприятие();
	
	ДатаВСД = ТекущаяДата();
	
	_сж = Товары.Добавить();
	
	_сж.КлючСтроки = 1;
	
	_всд = РезультатыОсмотра.Добавить();
	_всд.НазначениеГруза      = Ветис.Настройки_ВСД_НазначениеГруза();
	_всд.БлагополучиеМестности = Ветис.Настройки_ВСД_БлагополучиеМестности();
	_всд.Ветсанэкспертиза     = Ветис.Настройки_ВСД_ВСЭ();
	_всд.КонтрольГосВетврачем = Ветис.Настройки_ВСД_КонтрольГосВетврачем();
	_всд.ОсобыеОтметки        = Ветис.Настройки_ВСД_ОсобыеОтметки();
	
	_ттн = ТТН.Добавить();
	_ттн.Дата      = ТекущаяДата();
	_ттн.Тип       = Перечисления.ВетисDocumentType.ТовароТранспортнаяНакладная;
	_ттн.Транспорт = Ветис.Настройки_ТТН_Транспорт();
	
	Если ЗначениеЗаполнено(_ттн.Транспорт) Тогда
		_ттн.ТипТранспорта  = _ттн.Транспорт.ТипТранспорта;
		_ттн.НомерТранспорта= _ттн.Транспорт.Номер;
		_ттн.НомерПрицепа   = _ттн.Транспорт.НомерПрицепа;
		_ттн.Посредник      = _ттн.Транспорт.Перевозчик;
		_ттн.СпособХранения = _ттн.Транспорт.СпособХранения;
	Иначе
		_ттн.ТипТранспорта  = Перечисления.ВетисTransportType.Автомобильный;
		_ттн.Посредник      = Ветис.Настройки_ТТН_Посредник();
		_ттн.СпособХранения = Ветис.Настройки_ТТН_СпособХранения();
	КонецЕсли;
	
	Ответственный = Ветис.ТекущийПользователь();
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	//Если ДополнительныеСвойства.Свойство("Загрузка") Тогда
	//	Возврат;
	//КонецЕсли;
	
	//Если ЗначениеЗаполнено(uuid) И НЕ Ветис.РазрешенаОтладка() Тогда
	//	Отказ = Истина;
	//КонецЕсли;
	
	//Если ПометкаУдаления Тогда
	//	Возврат;
	//КонецЕсли;
	
	Если НЕ ДополнительныеСвойства.Свойство("Загрузка") Тогда
		Если ЗначениеЗаполнено(uuid) И НЕ Ветис.РазрешенаОтладка() Тогда
			Отказ = Истина;
			Возврат;
		КонецЕсли;
	КонецЕсли;
	
	//Дата = ДатаВСД;
	
	Если Товары.Количество() = 1 Тогда
		_СтрокаТовары = Товары[0];
		ProductType = _СтрокаТовары.ProductType;
		Product     = _СтрокаТовары.Product;
		SubProduct  = _СтрокаТовары.SubProduct;
		ProductItem = _СтрокаТовары.ProductItem;
		ProductItemName = _СтрокаТовары.ProductItemName;
		Количество  = _СтрокаТовары.Количество;
		_формат = ?(_СтрокаТовары.Скоропортящаяся, "ДФ='dd.MM.yy'", "ДФ='MM.yy'");
		
		//_День = Макс(День(_СтрокаТовары.СрокГодностиНачало), День(_СтрокаТовары.СрокГодностиКонец), День(_СтрокаТовары.ДатаВыработкиНачало), День(_СтрокаТовары.ДатаВыработкиКонец));
		//_Час = Макс(Час(_СтрокаТовары.СрокГодностиНачало), Час(_СтрокаТовары.СрокГодностиКонец), Час(_СтрокаТовары.ДатаВыработкиНачало), Час(_СтрокаТовары.ДатаВыработкиКонец));
		//_Мин = Макс(Минута(_СтрокаТовары.СрокГодностиНачало), Минута(_СтрокаТовары.СрокГодностиКонец), Минута(_СтрокаТовары.ДатаВыработкиНачало), Минута(_СтрокаТовары.ДатаВыработкиКонец));
		//
		//_ФорматДаты = ?(_Мин = 0, ?(_Час = 0, ?(_День = 1, "Мес", "День"), "Час"), "Мин");
		//
		//_формат = ?(_ФорматДаты = "Мес", "ДФ='MM.yy'", ?(_ФорматДаты = "День", "ДФ='dd.MM.yyyy'", ?(_ФорматДаты = "Час", "ДФ='dd.MM.yyyy HH'", "ДФ='dd.MM.yyyy HH:mm'")));
		
		ДатаВыработки  = ?(ЗначениеЗаполнено(_СтрокаТовары.ДатаВыработкиСтрокой), _СтрокаТовары.ДатаВыработкиСтрокой,
			Формат(_СтрокаТовары.ДатаВыработкиНачало, _формат)+"-"+Формат(_СтрокаТовары.ДатаВыработкиКонец, _формат));
		
		СрокГодности  = ?(ЗначениеЗаполнено(_СтрокаТовары.СрокГодностиСтрокой), _СтрокаТовары.СрокГодностиСтрокой,
			Формат(_СтрокаТовары.СрокГодностиНачало, _формат)+"-"+Формат(_СтрокаТовары.СрокГодностиКонец, _формат));
		
		СтранаПроисхождения  = _СтрокаТовары.СтранаПроисхождения;
	КонецЕсли;
	
	Если ТТН.Количество() = 1 Тогда
		НомерТТН = ТТН[0].Номер;
		ДатаТТН = ТТН[0].Дата;
	КонецЕсли;
	
	Если statusChange.Количество() > 0 Тогда
		ОтветственныйВетис = statusChange[statusChange.Количество()-1].specifiedPerson;
	КонецЕсли;
	
	Если Производители.Количество() > 0 Тогда
		Производитель = Производители[0].Предприятие;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриЗаписи(Отказ)
	
КонецПроцедуры

Процедура ОбработкаПроведения(Отказ, РежимПроведения)

КонецПроцедуры
