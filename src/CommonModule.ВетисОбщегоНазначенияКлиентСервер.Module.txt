
Функция ДобавитьОтбор(пОтбор, пПоле, пЗначение = Неопределено, пВидСравнения = Неопределено, пИспользование = Неопределено) Экспорт
	
	_Поле = Новый ПолеКомпоновкиДанных(пПоле);
	
	_Элементы = ОтборПолучитьЭлементы(пОтбор);
	
	_Найден = Ложь;
	
	Для каждого _Элемент Из _Элементы Цикл
		Если ТипЗнч(_Элемент) = Тип("ЭлементОтбораКомпоновкиДанных") И _Элемент.ЛевоеЗначение = _Поле Тогда
			_Найден = Истина;
			Прервать;
		КонецЕсли;
	КонецЦикла;
	
	Если _Найден = Ложь Тогда
		_Элемент = _Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	КонецЕсли;
	
	_Элемент.Использование = ?(пИспользование = Неопределено, Истина, пИспользование);
	
	Если НЕ пВидСравнения = Неопределено Тогда
		_Элемент.ВидСравнения = ПредопределенноеЗначение("ВидСравненияКомпоновкиДанных."+пВидСравнения);
	КонецЕсли;
	
	_Элемент.ЛевоеЗначение = _Поле;
	
	_Элемент.ПравоеЗначение = пЗначение;
	
КонецФункции

Функция ДобавитьГруппу(пОтбор, пИмя, пТипГруппы = Неопределено, пИспользование = Неопределено) Экспорт
	
	_Элементы = ОтборПолучитьЭлементы(пОтбор);
	
	_Найден = Ложь;
	
	Для каждого _Элемент Из _Элементы Цикл
		Если ТипЗнч(_Элемент) = Тип("ГруппаЭлементовОтбораКомпоновкиДанных") И _Элемент.Представление = пИмя Тогда
			_Найден = Истина;
			Прервать;
		КонецЕсли;
	КонецЦикла;
	
	Если _Найден = Ложь Тогда
		_Элемент = _Элементы.Добавить(Тип("ГруппаЭлементовОтбораКомпоновкиДанных"));
	КонецЕсли;
	
	_Элемент.Представление = пИмя;
	
	_Элемент.Использование = ?(пИспользование = Неопределено, Истина, пИспользование);
	
	Если пТипГруппы = Неопределено Тогда
		_Элемент.ТипГруппы = ПредопределенноеЗначение("ТипГруппыЭлементовОтбораКомпоновкиДанных.ГруппаИ");
	Иначе
		_Элемент.ТипГруппы = ПредопределенноеЗначение("ТипГруппыЭлементовОтбораКомпоновкиДанных."+пТипГруппы);
	КонецЕсли;
	
	Возврат _Элемент;
	
КонецФункции

Функция ОтборПолучитьЭлементы(Источник) Экспорт
	
	Результат = Неопределено;
	
	Если ТипЗнч(Источник) = Тип("КомпоновщикНастроекКомпоновкиДанных") Тогда
		Результат = Источник.Настройки.Отбор.Элементы;
		
	ИначеЕсли ТипЗнч(Источник) = Тип("НастройкиКомпоновкиДанных") Тогда
		Результат = Источник.Отбор.Элементы;
		
	ИначеЕсли ТипЗнч(Источник) = Тип("ОтборКомпоновкиДанных") Тогда
		Результат = Источник.Элементы;
		
	ИначеЕсли ТипЗнч(Источник) = Тип("КоллекцияЭлементовОтбораКомпоновкиДанных") Тогда
		Результат = Источник;
		
	ИначеЕсли ТипЗнч(Источник) = Тип("ГруппаЭлементовОтбораКомпоновкиДанных") Тогда
		Результат = Источник.Элементы;
		
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции
