
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("Guid") Тогда
		Guid = Параметры.Guid;
	КонецЕсли;
	
	Если Параметры.Свойство("ProductItem") Тогда
		ProductItem = Параметры.ProductItem;
	КонецЕсли;
	
	Если Параметры.Свойство("Предприятие") Тогда
		Объект.Предприятие = Параметры.Предприятие;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Guid) И НЕ ЗначениеЗаполнено(ProductItem) Тогда
		ProductItem = Ветис.Соответствие_ПолучитьСсылку(Guid, "Справочник.ВетисProductItem");
		ЕстьСвязь = ЗначениеЗаполнено(ProductItem);
	ИначеЕсли НЕ ЗначениеЗаполнено(Guid) И ЗначениеЗаполнено(ProductItem) Тогда
		Guid = Ветис.Соответствие_ПолучитьGuid(ProductItem);
		ЕстьСвязь = ЗначениеЗаполнено(Guid);
	Иначе
		ЕстьСвязь = Guid = Ветис.Соответствие_ПолучитьGuid(ProductItem);
	КонецЕсли;
	
	Элементы.Предприятие.Видимость = Ветис.Версия_2_0();
	
	Элементы.ДекорацияСвязь.Картинка = ?(ЕстьСвязь, БиблиотекаКартинок.ВетисЕстьСвязь, БиблиотекаКартинок.ВетисНетСвязи);
	
	КомандаНайтиПоGuidСервер();
	
	Если НЕ ЗначениеЗаполнено(ProductItem) И ЗначениеЗаполнено(Наименование) Тогда
		ProductItem = Справочники.ВетисProductItem.НайтиПоНаименованию(Наименование);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
КонецПроцедуры


&НаКлиенте
Процедура КомандаГотово(Команда)
	
	Если ЕстьСвязь = Ложь Тогда
		ПоказатьВопрос(Новый ОписаниеОповещения("СоздатьСвязьОбработкаОповещения", ЭтаФорма), "Создать связь?", РежимДиалогаВопрос.ДаНетОтмена);
	Иначе
		Закрыть(ProductItem);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СоздатьСвязьОбработкаОповещения(пРезультат, пПараметры) Экспорт
	
	Если пРезультат = КодВозвратаДиалога.Да Тогда
		
		//ВетисВызовСервера.Соответствие_ДобавитьProductItem(ProductItem, Объект.Предприятие, Guid, Наименование);
		
		Закрыть(ProductItem);
		
	ИначеЕсли пРезультат = КодВозвратаДиалога.Нет Тогда
		
		Закрыть(ProductItem);
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаНайти(Команда)
	
	КомандаНайтиПоGuidСервер();
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаДобавить(Команда)
	
	_оо = Новый ОписаниеОповещения("КомандаДобавитьОбработкаОповещения", ЭтаФорма);
	
	_форма = ОткрытьФорму("Справочник.ВетисProductItem.ФормаОбъекта",,,,,,_оо);
	
	ЗаполнитьЗначенияСвойств(_форма.Объект, ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаДобавитьОбработкаОповещения(пРезультат, пПараметры) Экспорт
	
	Если НЕ пРезультат = Неопределено Тогда
		
		ProductItem = пРезультат;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ДекорацияЕстьСвязь1Нажатие(Элемент)
	
	ЕстьСвязь = НЕ ЕстьСвязь;
	
	Если ЕстьСвязь Тогда
		//ВетисВызовСервера.Соответствие_ДобавитьProductItem(ProductItem, Объект.Предприятие, Guid, Наименование);
	Иначе
		//ВетисВызовСервера.Соответствие_УдалитьProductItem(ProductItem, Объект.Предприятие);
	КонецЕсли;
	
	Элементы.ДекорацияСвязь.Картинка = ?(ЕстьСвязь, БиблиотекаКартинок.ВетисЕстьСвязь, БиблиотекаКартинок.ВетисНетСвязи);
	
КонецПроцедуры


&НаКлиенте
Процедура GuidПриИзменении(Элемент)
	
	ЕстьСвязь = Guid = ВетисВызовСервера.Соответствие_ПолучитьGuid(ProductItem);
	
	Элементы.ДекорацияСвязь.Картинка = ?(ЕстьСвязь, БиблиотекаКартинок.ВетисЕстьСвязь, БиблиотекаКартинок.ВетисНетСвязи);
	
КонецПроцедуры

&НаКлиенте
Процедура НоменклатураПриИзменении(Элемент)
	
	ЕстьСвязь = Guid = ВетисВызовСервера.Соответствие_ПолучитьGuid(ProductItem);
	
	Элементы.ДекорацияСвязь.Картинка = ?(ЕстьСвязь, БиблиотекаКартинок.ВетисЕстьСвязь, БиблиотекаКартинок.ВетисНетСвязи);
	
КонецПроцедуры


&НаСервере
Процедура КомандаНайтиПоGuidСервер()
	
	Если ЗначениеЗаполнено(Guid) Тогда
		
		_Версия20 = Ветис.Версия_2_0();
		
		_productItem = ?(_Версия20, ВетисProductService, ВетисProductService_2_0).GetProductItemByGuid(Guid);
		
		Элементы.ГруппаПредупреждение.Видимость = _productItem = Неопределено;
		Элементы.ГруппаРеквизиты.Видимость = НЕ _productItem = Неопределено;
		
	КонецЕсли;
	
	Если НЕ _productItem = Неопределено Тогда
		Наименование = _productItem.Name;
		
		productType = ?(_Версия20, ВетисArgusProductionСлой1с, ВетисDictionaryСлой1с).ProductType(_productItem.productType);
		product = ?(_Версия20, ВетисProductService, ВетисProductService_2_0).GetProductByGuid(_productItem.product.guid).name;
		subProduct = ?(_Версия20, ВетисProductService, ВетисProductService_2_0).GetSubProductByGuid(_productItem.subProduct.guid).name;
		
		//Если _Версия20 Тогда
		//	Объект.Предприятие = ВетисDictionaryСлой1с.ProductItemProducing(_productItem.producing);
		//КонецЕсли;
		
	Иначе
		productType = Неопределено;
		product = "";
		subProduct = "";
		Наименование = "";
	КонецЕсли;
	
КонецПроцедуры
