
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("Заголовок") Тогда
		Заголовок = Параметры.Заголовок;
	КонецЕсли;
	
	Если Параметры.Свойство("КлючСвязи") Тогда
		КлючСвязи = Параметры.КлючСвязи;
	КонецЕсли;
	
	Если Параметры.Свойство("PackageList") Тогда
		Для каждого _Строка Из Параметры.PackageList Цикл
			ЗаполнитьЗначенияСвойств(PackageList.Добавить(), _Строка);
		КонецЦикла;
	КонецЕсли;
	
	Если Параметры.Свойство("ProductMarks") Тогда
		Для каждого _Строка Из Параметры.ProductMarks Цикл
			ЗаполнитьЗначенияСвойств(ProductMarks.Добавить(), _Строка);
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаГотово(Команда)
	
	Закрыть();
	
КонецПроцедуры

&НаКлиенте
Процедура PackageListПриАктивизацииПоля(Элемент)
	
	_ТекущиеДанные = Элементы.PackageList.ТекущиеДанные;
	
	Если _ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Элементы.ProductMarks.ОтборСтрок = Новый ФиксированнаяСтруктура("КлючСвязи", _ТекущиеДанные.КлючСтроки);
	
КонецПроцедуры

&НаКлиенте
Процедура PackageListПриНачалеРедактирования(Элемент, НоваяСтрока, Копирование)
	
	Если НоваяСтрока Тогда
		Элемент.ТекущиеДанные.КлючСвязи = КлючСвязи;
		Элемент.ТекущиеДанные.КлючСтроки = ПолучитьКлючСтрокиУпаковка();
		Элементы.ProductMarks.ОтборСтрок = Новый ФиксированнаяСтруктура("КлючСвязи", Элемент.ТекущиеДанные.КлючСтроки);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура PackageListПередУдалением(Элемент, Отказ)
	
	Для каждого _Строка Из ProductMarks.НайтиСтроки(Новый Структура("КлючСвязи", Элемент.ТекущиеДанные.КлючСтроки)) Цикл
		ProductMarks.Удалить(_Строка);
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Функция ПолучитьКлючСтрокиУпаковка()
	
	_список = PackageList.Выгрузить().ВыгрузитьКолонку("КлючСтроки");
	
	Для _Индекс = 1 По 999 Цикл
		Если _список.Найти(_Индекс) = Неопределено Тогда
			Возврат _Индекс;
		КонецЕсли;
	КонецЦикла;
	
КонецФункции
