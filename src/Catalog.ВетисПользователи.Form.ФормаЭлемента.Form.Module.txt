
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если ЗначениеЗаполнено(Объект.Идентификатор) Тогда
		_ПользовательИБ = ПользователиИнформационнойБазы.НайтиПоУникальномуИдентификатору(Объект.Идентификатор);
		Пароль = "**************";
	КонецЕсли;
	
	Для каждого _Роль Из Метаданные.Роли Цикл
		СписокРолей.Добавить(_Роль.Имя, _Роль.Синоним, ?(_ПользовательИБ = Неопределено, Ложь, _ПользовательИБ.Роли.Содержит(_Роль)));
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	
КонецПроцедуры

&НаКлиенте
Процедура ПослеЗаписи(ПараметрыЗаписи)
	
	СоздатьПользователяИБ();
	
КонецПроцедуры

&НаСервере
Процедура СоздатьПользователяИБ()
	
	Если ЗначениеЗаполнено(Объект.Идентификатор) Тогда
		_ПользовательИБ = ПользователиИнформационнойБазы.НайтиПоУникальномуИдентификатору(Объект.Идентификатор);
	Иначе
		_ПользовательИБ = ПользователиИнформационнойБазы.СоздатьПользователя();
	КонецЕсли;
	
	_ПользовательИБ.Имя = Объект.Код;
	_ПользовательИБ.ПолноеИмя = Объект.Наименование;
	
	Если ПарольУстановлен Тогда
		_ПользовательИБ.Пароль = Пароль;
	КонецЕсли;
	
	_ПользовательИБ.Роли.Очистить();
	Для каждого _Роль Из СписокРолей Цикл
		Если _Роль.Пометка Тогда
			_ПользовательИБ.Роли.Добавить(Метаданные.Роли.Найти(_Роль.Значение));
		КонецЕсли;
	КонецЦикла;
	
	_ПользовательИБ.Записать();
	
	Если НЕ ЗначениеЗаполнено(Объект.Идентификатор) Тогда
		Объект.Идентификатор = _ПользовательИБ.УникальныйИдентификатор;
		Записать();
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПарольПриИзменении(Элемент)
	
	ПарольУстановлен = Истина;
	
КонецПроцедуры
