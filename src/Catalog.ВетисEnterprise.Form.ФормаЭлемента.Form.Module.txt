
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	уид = Объект.Ссылка.УникальныйИдентификатор();
	
	ЗаполнитьРеквизиты(Объект);
	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗакрытием(Отказ, ЗавершениеРаботы, ТекстПредупреждения, СтандартнаяОбработка)
	
	//СтандартнаяОбработка = Ложь;
	
	//Закрыть(Объект.Ссылка);
	
КонецПроцедуры


&НаКлиенте
Процедура КомандаСоздатьВСервисе(Команда)
	
	Перем _Ошибка, _Отказ;
	
	ModifyEnterprise(Истина, _Отказ, _Ошибка);
	
	Если _Отказ = Истина Тогда
		Сообщить(_Ошибка);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаОбновитьВСервисе(Команда)
	
	Перем _Ошибка, _Отказ;
	
	ModifyEnterprise(Ложь, _Отказ, _Ошибка);
	
	Если _Отказ = Истина Тогда
		Сообщить(_Ошибка);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаЗаполнитьИзСервиса(Команда)
	
	Перем _Ошибка, _Отказ;
	
	КомандаЗаполнитьИзСервисаНаСервере(_Отказ, _Ошибка);
	
	Если _Отказ = Истина Тогда
		Сообщить(_Ошибка);
	Иначе
		Модифицированность = Истина;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура КомандаЗаполнитьИзСервисаНаСервере(пОтказ, пОшибка)
	
	_guid = Строка(Объект.Ссылка.УникальныйИдентификатор());
	
	_Enterprise = ВетисEnterpriseService.GetEnterpriseByGuid(_guid, пОтказ, пОшибка);
	
	Если пОтказ = Истина Тогда
		Возврат;
	КонецЕсли;
	
	Модифицированность = Истина;
	
	_Объект = РеквизитФормыВЗначение("Объект");
	
	_Объект.Заполнить(_Enterprise);
	
	ЗначениеВРеквизитФормы(_Объект, "Объект");
	
	Объект.Наименование = СокрЛП(_Enterprise.name);
	
	ЗаполнитьРеквизиты(_Enterprise);
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаСледующая(Команда)
	
	Если ЗначениеЗаполнено(next) Тогда
		КомандаСледующаяНаСервере(next);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаПредыдущая(Команда)
	
	Если ЗначениеЗаполнено(previous) Тогда
		КомандаСледующаяНаСервере(previous);
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура КомандаСледующаяНаСервере(Знач пUuid)
	
	_en = ВетисEnterpriseService.GetEnterpriseByUuid(пUuid);
	
	_Объект = РеквизитФормыВЗначение("Объект");
	
	_Объект.Заполнить(_en);
	
	ЗначениеВРеквизитФормы(_Объект, "Объект");
	
	ЗаполнитьРеквизиты(_en);
	
	Модифицированность = Истина;
	
КонецПроцедуры


&НаСервере
Процедура ModifyEnterprise(пСоздать = Истина, пОтказ, пОшибка)
	
	_EnterpriseList = ВетисMercuryApplicationsСлой1с.ModifyEnterprise(Объект, , пСоздать, пОтказ, пОшибка);
	
	Если пОтказ = Истина Тогда
		Возврат;
	КонецЕсли;
	
	//Если ТипЗнч(_Enterprise) = Тип("СписокXDTO") Тогда
	//	_EnterpriseList = _Enterprise;
		Для каждого _Enterprise Из _EnterpriseList Цикл
			Если _Enterprise.last И _Enterprise.active Тогда
				Прервать;
			КонецЕсли;
		КонецЦикла;
	//КонецЕсли;
	
	_Объект = РеквизитФормыВЗначение("Объект");
	
	_Объект.Заполнить(_Enterprise);
	
	ЗначениеВРеквизитФормы(_Объект, "Объект");
	
	ЗаполнитьРеквизиты(_Enterprise);
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьРеквизиты(value)
	
	last     = value.last;
	active   = value.active;
	_uuid    = value.uuid;
	next     = value.next;
	
	Если ТипЗнч(value) = Тип("ОбъектXDTO") Тогда
		status   = ВетисBaseСлой1с.VersionStatus(value.Status);
		previous = value.previous;
		createDate = value.createDate;
		updateDate = value.updateDate;
	Иначе
		status   = value.Status;
	КонецЕсли;
	
КонецПроцедуры

