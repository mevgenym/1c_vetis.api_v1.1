
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
КонецПроцедуры


&НаКлиенте
Процедура КомандаЗаполнитьИзСервиса(Команда)
	
	Перем _Ошибка, _Отказ;
	
	Для каждого _Ссылка Из Элементы.Список.ВыделенныеСтроки Цикл
		ЗаполнитьИзСервиса(_Ссылка, _Ошибка, _Отказ);
		Если _Ошибка = Истина Тогда
			Сообщить(_Ошибка);
			Прервать;
		КонецЕсли;
	КонецЦикла;
	
	Элементы.Список.Обновить();
	
КонецПроцедуры


&НаСервереБезКонтекста
Процедура ЗаполнитьИзСервиса(пСсылка, пОтказ, пОшибка)
	
	_Объект = пСсылка.ПолучитьОбъект();
	
	Если Ветис.Версия_2_0() Тогда
		
		Если ПустаяСтрока(_Объект.guid) Тогда
			пОтказ = Истина;
			пОшибка = "Предприятие не сопоставлено";
			Возврат;
		КонецЕсли;
		
		_Enterprise = ВетисEnterpriseService_2_0.GetEnterpriseByGuid(_Объект.guid, пОтказ, пОшибка);
		
		Если пОтказ = Истина Тогда
			Возврат;
		КонецЕсли;
		
	Иначе
		
		Если ПустаяСтрока(_Объект.guid) Тогда
			пОтказ = Истина;
			пОшибка = "Предприятие не сопоставлено";
			Возврат;
		КонецЕсли;
		
		_Enterprise = ВетисEnterpriseService.GetEnterpriseByGuid(_Объект.guid, пОтказ, пОшибка);
		
		Если пОтказ = Истина Тогда
			Возврат;
		КонецЕсли;
		
	КонецЕсли;
	
	_Объект.Заполнить(_Enterprise);
	
	_Объект.Записать();
	
КонецПроцедуры
